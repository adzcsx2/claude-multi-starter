#!/usr/bin/env python3
"""
launch - Start Claude Code Bridge with multiple instances.

Usage:
    launch

Description:
    Launches the Claude Code Bridge environment with configured instances in WezTerm.
"""

from __future__ import annotations

import os
import sys
from pathlib import Path

script_dir = Path(__file__).resolve().parent
project_root = script_dir.parent
sys.path.insert(0, str(project_root / "lib"))

from compat import setup_windows_encoding
setup_windows_encoding()


def main():
    """Start Claude Code Bridge."""
    # 保持在用户的当前目录，不要切换到安装目录
    # 用户应该在项目目录中运行 start-claude
    
    # Run start-dynamic.py by executing it in the same process
    start_script = project_root / "start-dynamic.py"
    
    if not start_script.exists():
        print(f"Error: {start_script} not found", file=sys.stderr)
        sys.exit(1)
    
    # Execute the script directly using exec
    # Read and strip BOM if present
    try:
        with open(start_script, 'r', encoding='utf-8-sig') as f:
            content = f.read()
        code = compile(content, str(start_script), 'exec')
        exec(code, {'__name__': '__main__', '__file__': str(start_script)})
    except KeyboardInterrupt:
        print("\nInterrupted by user")
        sys.exit(130)
    except Exception as e:
        print(f"Error starting CCB: {e}", file=sys.stderr)
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    main()
